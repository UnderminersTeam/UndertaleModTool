<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:l="clr-namespace:UndertaleModToolAvalonia"
             xmlns:undertalem="clr-namespace:UndertaleModLib.Models;assembly=UndertaleModLib"
             xmlns:AvaloniaEdit="clr-namespace:AvaloniaEdit;assembly=AvaloniaEdit"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
             x:Class="UndertaleModToolAvalonia.UndertaleCodeView"
             x:DataType="l:UndertaleCodeViewModel">
    <Grid RowDefinitions="Auto,1*" ColumnDefinitions="1*" MaxHeight="{Binding $parent[ContentControl].Bounds.Height}">
        <Grid Grid.Row="0" ColumnDefinitions="1*,Auto" Classes="PaddedProperties">
            <Grid Grid.Column="0" l:AutoGridBehavior.Enable="True" ColumnDefinitions="1*,3*">
                <Label>Name</Label>
                <l:UndertaleStringReferenceView Reference="{Binding Code.Name}" />

                <Label>Parent</Label>
                <l:UndertaleResourceReferenceView Reference="{Binding Code.ParentEntry}" ReferenceType="undertalem:UndertaleCode" />
            </Grid>
            <Button Grid.Column="1" Command="{Binding CompileAndDecompileGML}">Compile and decompile</Button>
        </Grid>
        
        <TabControl Grid.Row="1" IsVisible="{Binding Code.ParentEntry, Converter={x:Static ObjectConverters.IsNull}}"
                    SelectedIndex="{Binding SelectedTab}">
            <TabItem Header="GML">
                <ThemeVariantScope RequestedThemeVariant="Dark">
                    <AvaloniaEdit:TextEditor x:Name="GMLTextEditor"
                                             Document="{Binding GMLTextDocument}"
                                             TextChanged="GMLTextEditor_TextChanged"
                                             ShowLineNumbers="True"
                                             Background="#FF282828"
                                             FontFamily="Consolas,Liberation Mono,Menlo">
                        <AvaloniaEdit:TextEditor.KeyBindings>
                            <KeyBinding Gesture="Ctrl+K" Command="{Binding CompileAndDecompileGML}" />
                        </AvaloniaEdit:TextEditor.KeyBindings>
                    </AvaloniaEdit:TextEditor>
                </ThemeVariantScope>
            </TabItem>
            <TabItem Header="ASM">
                <ThemeVariantScope RequestedThemeVariant="Dark">
                    <AvaloniaEdit:TextEditor x:Name="ASMTextEditor"
                                             Document="{Binding ASMTextDocument}"
                                             TextChanged="ASMTextEditor_TextChanged"
                                             ShowLineNumbers="True"
                                             Background="#FF282828"
                                             FontFamily="Consolas,Liberation Mono,Menlo">
                        <AvaloniaEdit:TextEditor.KeyBindings>
                            <KeyBinding Gesture="Ctrl+K" Command="{Binding CompileAndDecompileASM}" />
                        </AvaloniaEdit:TextEditor.KeyBindings>
                    </AvaloniaEdit:TextEditor>
                </ThemeVariantScope>
            </TabItem>
        </TabControl>
        
        <TextBlock Grid.Row="1" IsVisible="{Binding Code.ParentEntry, Converter={x:Static ObjectConverters.IsNotNull}}" Classes="PaddedProperties">
            <Run Text="This code entry is a reference to an anonymous function within " /><Run Text="{Binding Code.ParentEntry.Name.Content}"/><Run Text=", view it there." />
        </TextBlock>
    </Grid>
</UserControl>
